# PKMS 上手指南

## 1. 项目配置

### 1.1 环境变量配置

系统支持通过环境变量或 `.env` 文件进行配置。创建 `.env` 文件在项目根目录：

```bash
# 应用环境配置
APP_ENV=development
CONTEXT_TIMEOUT=60

# 数据库配置
DB_TYPE=sqlite           # 支持 sqlite 或 postgres
DB_PATH=./data.db       # SQLite 数据库文件路径
# DB_DSN=postgres://username:password@host:port/database?sslmode=disable  # PostgreSQL 连接字符串

# JWT 令牌配置
ACCESS_TOKEN_EXPIRY_HOUR=3
REFRESH_TOKEN_EXPIRY_HOUR=24
ACCESS_TOKEN_SECRET=your-access-token-secret
REFRESH_TOKEN_SECRET=your-refresh-token-secret

# 管理员账户配置
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your-admin-password

# 存储配置
STORAGE_TYPE=disk               # 支持 disk 或 minio
STORAGE_BASE_PATH=./uploads     # 本地存储路径

# MinIO/S3 配置 (当 STORAGE_TYPE=minio 时)
S3_ADDRESS=your-minio-host:9000
S3_ACCESS_KEY=your-access-key
S3_SECRET_KEY=your-secret-key
S3_BUCKET=pkms
S3_TOKEN=
```

### 1.2 数据库配置

#### SQLite 配置 (默认)
```bash
DB_TYPE=sqlite
DB_PATH=./data.db
```

#### PostgreSQL 配置
```bash
DB_TYPE=postgres
DB_DSN=postgres://username:password@host:port/database?sslmode=disable
```

#### 生产环境 PostgreSQL 示例
```bash
DB_TYPE=postgres
DB_DSN=postgres://hao88:Hao88.cloud!@192.168.99.17:5432/pkms?sslmode=disable
```

### 1.3 RBAC 权限配置

权限模型配置位于 `config/rbac_model.conf`，采用领域驱动的 RBAC 模型：

- **请求格式**: `sub, dom, obj, act` (主体, 域, 资源, 操作)
- **策略格式**: `sub, dom, obj, act` (主体, 域, 资源, 操作)
- **角色定义**: 三元组关系 `_, _, _`

支持的角色：
- `admin`: 管理员，拥有所有权限
- `pm`: 项目经理，可管理项目和包
- `user`: 普通用户，只读权限

### 1.4 存储配置

#### 本地存储 (默认)
```bash
STORAGE_TYPE=disk
STORAGE_BASE_PATH=./uploads
```

#### MinIO/S3 存储
```bash
STORAGE_TYPE=minio
S3_ADDRESS=192.168.8.6:9000
S3_ACCESS_KEY=IjJm2N3ZZTYjt8C9WkJf
S3_SECRET_KEY=eIuV0i4ChbLqx54g9rhsZDRTC2LE1xEcnIAnAw1C
S3_BUCKET=pkms
```

## 2. 开发环境搭建

### 2.1 前置要求

- **Go**: 1.19 或更高版本
- **Node.js**: 16.x 或更高版本
- **npm**: 8.x 或更高版本

### 2.2 启动开发环境

#### 启动后端服务
```bash
# 生成 Ent 数据库代码 (首次或修改 schema 后)
go generate ./ent

# 启动后端开发服务器 (端口 65080)
go run ./cmd/main.go
```

#### 启动前端开发服务器
```bash
cd frontend

# 安装依赖 (首次)
npm install

# 启动开发服务器 (端口 5173)
npm run dev
```

访问应用：
- 前端: http://localhost:5173
- 后端 API: http://localhost:65080
- Swagger 文档: http://localhost:65080/swagger/index.html

### 2.3 生产部署

#### 构建应用
```bash
# 1. 构建前端
cd frontend
npm run build

# 2. 构建后端 (包含前端静态文件)
cd ..
go build -o pkms ./cmd/main.go
```

#### Docker 部署
```bash
# 构建镜像
docker build -t hao88/pkms:latest .

# 运行容器
docker run -p 65080:65080 \
  -e DB_TYPE=postgres \
  -e DB_DSN="postgres://user:pass@host:5432/pkms?sslmode=disable" \
  hao88/pkms:latest
```

## 3. 新功能开发指南

### 3.1 后端功能开发

#### 3.1.1 添加新实体 (Entity)

1. **定义数据库 Schema**
   在 `ent/schema/` 目录创建新的 schema 文件：

```go
// ent/schema/example.go
package schema

import (
    "entgo.io/ent"
    "entgo.io/ent/schema/field"
    "time"
)

type Example struct {
    ent.Schema
}

func (Example) Fields() []ent.Field {
    return []ent.Field{
        field.String("name").NotEmpty(),
        field.String("description").Optional(),
        field.Time("created_at").Default(time.Now),
        field.Time("updated_at").Default(time.Now).UpdateDefault(time.Now),
    }
}
```

2. **生成 Ent 代码**
```bash
go generate ./ent
```

3. **创建领域模型**
   在 `domain/` 目录创建对应的领域模型：

```go
// domain/example.go
package domain

import "time"

type Example struct {
    ID          int       `json:"id"`
    Name        string    `json:"name"`
    Description string    `json:"description"`
    CreatedAt   time.Time `json:"created_at"`
    UpdatedAt   time.Time `json:"updated_at"`
}

type ExampleRequest struct {
    Name        string `json:"name" binding:"required"`
    Description string `json:"description"`
}

type ExampleResponse struct {
    Data []Example `json:"data"`
}
```

#### 3.1.2 实现数据访问层 (Repository)

在 `repository/` 目录创建新的仓储：

```go
// repository/ent_example_repository.go
package repository

import (
    "context"
    "pkms/domain"
    "pkms/ent"
    "pkms/ent/example"
)

type ExampleRepository interface {
    GetAll(ctx context.Context) ([]*ent.Example, error)
    GetByID(ctx context.Context, id int) (*ent.Example, error)
    Create(ctx context.Context, req *domain.ExampleRequest) (*ent.Example, error)
    Update(ctx context.Context, id int, req *domain.ExampleRequest) (*ent.Example, error)
    Delete(ctx context.Context, id int) error
}

type entExampleRepository struct {
    client *ent.Client
}

func NewEntExampleRepository(client *ent.Client) ExampleRepository {
    return &entExampleRepository{client: client}
}

func (r *entExampleRepository) GetAll(ctx context.Context) ([]*ent.Example, error) {
    return r.client.Example.Query().All(ctx)
}

// 实现其他方法...
```

#### 3.1.3 实现业务逻辑层 (Usecase)

在 `usecase/` 目录创建用例：

```go
// usecase/example_usecase.go
package usecase

import (
    "context"
    "pkms/domain"
    "pkms/repository"
)

type ExampleUsecase interface {
    GetAll(ctx context.Context) ([]*domain.Example, error)
    GetByID(ctx context.Context, id int) (*domain.Example, error)
    Create(ctx context.Context, req *domain.ExampleRequest) (*domain.Example, error)
    Update(ctx context.Context, id int, req *domain.ExampleRequest) (*domain.Example, error)
    Delete(ctx context.Context, id int) error
}

type exampleUsecase struct {
    exampleRepo repository.ExampleRepository
    timeout     time.Duration
}

func NewExampleUsecase(exampleRepo repository.ExampleRepository, timeout time.Duration) ExampleUsecase {
    return &exampleUsecase{
        exampleRepo: exampleRepo,
        timeout:     timeout,
    }
}

func (u *exampleUsecase) GetAll(ctx context.Context) ([]*domain.Example, error) {
    ctx, cancel := context.WithTimeout(ctx, u.timeout)
    defer cancel()
    
    examples, err := u.exampleRepo.GetAll(ctx)
    if err != nil {
        return nil, err
    }
    
    // 转换为领域模型
    var result []*domain.Example
    for _, example := range examples {
        result = append(result, &domain.Example{
            ID:          example.ID,
            Name:        example.Name,
            Description: example.Description,
            CreatedAt:   example.CreatedAt,
            UpdatedAt:   example.UpdatedAt,
        })
    }
    
    return result, nil
}

// 实现其他方法...
```

#### 3.1.4 实现控制器层 (Controller)

在 `api/controller/` 目录创建控制器：

```go
// api/controller/example_controller.go
package controller

import (
    "net/http"
    "pkms/domain"
    "pkms/usecase"
    "strconv"
    
    "github.com/gin-gonic/gin"
)

type ExampleController struct {
    exampleUsecase usecase.ExampleUsecase
}

func NewExampleController(exampleUsecase usecase.ExampleUsecase) *ExampleController {
    return &ExampleController{
        exampleUsecase: exampleUsecase,
    }
}

// @Summary      获取所有示例
// @Description  获取示例列表
// @Tags         Examples
// @Accept       json
// @Produce      json
// @Security     BearerAuth
// @Success      200  {object}  domain.Response{data=[]domain.Example}
// @Failure      500  {object}  domain.Response
// @Router       /examples [get]
func (c *ExampleController) GetAll(ctx *gin.Context) {
    examples, err := c.exampleUsecase.GetAll(ctx.Request.Context())
    if err != nil {
        ctx.JSON(http.StatusInternalServerError, domain.Response{
            Status:  "error",
            Message: err.Error(),
        })
        return
    }
    
    ctx.JSON(http.StatusOK, domain.Response{
        Status: "success",
        Data:   examples,
    })
}

// @Summary      创建示例
// @Description  创建新的示例
// @Tags         Examples
// @Accept       json
// @Produce      json
// @Security     BearerAuth
// @Param        example  body  domain.ExampleRequest  true  "示例数据"
// @Success      201  {object}  domain.Response{data=domain.Example}
// @Failure      400  {object}  domain.Response
// @Failure      500  {object}  domain.Response
// @Router       /examples [post]
func (c *ExampleController) Create(ctx *gin.Context) {
    var req domain.ExampleRequest
    if err := ctx.ShouldBindJSON(&req); err != nil {
        ctx.JSON(http.StatusBadRequest, domain.Response{
            Status:  "error",
            Message: err.Error(),
        })
        return
    }
    
    example, err := c.exampleUsecase.Create(ctx.Request.Context(), &req)
    if err != nil {
        ctx.JSON(http.StatusInternalServerError, domain.Response{
            Status:  "error",
            Message: err.Error(),
        })
        return
    }
    
    ctx.JSON(http.StatusCreated, domain.Response{
        Status: "success",
        Data:   example,
    })
}

// 实现其他方法...
```

#### 3.1.5 添加路由

在 `api/route/` 目录创建路由文件：

```go
// api/route/example_route.go
package route

import (
    "pkms/api/controller"
    "pkms/api/middleware"
    "time"
    
    "github.com/gin-gonic/gin"
)

func NewExampleRouter(env *bootstrap.Env, timeout time.Duration, db *ent.Client, group *gin.RouterGroup) {
    exampleRepo := repository.NewEntExampleRepository(db)
    exampleUsecase := usecase.NewExampleUsecase(exampleRepo, timeout)
    exampleController := controller.NewExampleController(exampleUsecase)
    
    // 应用 JWT 中间件和权限中间件
    exampleGroup := group.Group("/examples").Use(middleware.JwtAuthMiddleware(env.AccessTokenSecret))
    {
        exampleGroup.GET("", 
            middleware.CasbinMiddleware("example", "read"), 
            exampleController.GetAll)
        exampleGroup.POST("", 
            middleware.CasbinMiddleware("example", "write"), 
            exampleController.Create)
        exampleGroup.GET("/:id", 
            middleware.CasbinMiddleware("example", "read"), 
            exampleController.GetByID)
        exampleGroup.PUT("/:id", 
            middleware.CasbinMiddleware("example", "write"), 
            exampleController.Update)
        exampleGroup.DELETE("/:id", 
            middleware.CasbinMiddleware("example", "delete"), 
            exampleController.Delete)
    }
}
```

在主路由文件中注册：

```go
// api/route/route.go
func Setup(env *bootstrap.Env, timeout time.Duration, db *ent.Client, gin *gin.Engine) {
    // 现有路由...
    
    // 添加新的路由
    NewExampleRouter(env, timeout, db, publicRouter) // 或 protectedRouter
}
```

#### 3.1.6 更新依赖注入

在 `bootstrap/app.go` 中添加必要的依赖注入配置。

#### 3.1.7 更新 Swagger 文档

添加 API 注解后，重新生成文档：

```bash
swag init -g cmd/main.go -o docs
```

### 3.2 前端功能开发

#### 3.2.1 创建 TypeScript 类型定义

在 `frontend/src/types/` 目录创建类型文件：

```typescript
// frontend/src/types/example.ts
export interface Example {
  id: number;
  name: string;
  description?: string;
  created_at: string;
  updated_at: string;
}

export interface ExampleRequest {
  name: string;
  description?: string;
}

export interface ExampleResponse {
  status: string;
  data: Example[];
  message?: string;
}

export interface ExampleFilters {
  search?: string;
  page?: number;
  limit?: number;
}
```

#### 3.2.2 创建 API 服务

在 `frontend/src/lib/api/` 目录创建 API 服务：

```typescript
// frontend/src/lib/api/examples.ts
import { apiClient } from './api';
import type { Example, ExampleRequest, ExampleResponse, ExampleFilters } from '@/types/example';

export const examplesApi = {
  // 获取所有示例
  getAll: async (filters?: ExampleFilters): Promise<Example[]> => {
    const response = await apiClient.get<ExampleResponse>('/examples', {
      params: filters,
    });
    return response.data.data;
  },

  // 根据ID获取示例
  getById: async (id: number): Promise<Example> => {
    const response = await apiClient.get<{ status: string; data: Example }>(`/examples/${id}`);
    return response.data.data;
  },

  // 创建示例
  create: async (data: ExampleRequest): Promise<Example> => {
    const response = await apiClient.post<{ status: string; data: Example }>('/examples', data);
    return response.data.data;
  },

  // 更新示例
  update: async (id: number, data: ExampleRequest): Promise<Example> => {
    const response = await apiClient.put<{ status: string; data: Example }>(`/examples/${id}`, data);
    return response.data.data;
  },

  // 删除示例
  delete: async (id: number): Promise<void> => {
    await apiClient.delete(`/examples/${id}`);
  },
};
```

#### 3.2.3 创建自定义 Hook

在 `frontend/src/hooks/` 目录创建数据获取 Hook：

```typescript
// frontend/src/hooks/use-examples.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { examplesApi } from '@/lib/api/examples';
import type { Example, ExampleRequest, ExampleFilters } from '@/types/example';
import { toast } from '@/hooks/use-toast';

export const useExamples = (filters?: ExampleFilters) => {
  return useQuery({
    queryKey: ['examples', filters],
    queryFn: () => examplesApi.getAll(filters),
    staleTime: 0, // 总是重新获取新数据
  });
};

export const useExample = (id: number) => {
  return useQuery({
    queryKey: ['example', id],
    queryFn: () => examplesApi.getById(id),
    enabled: !!id,
  });
};

export const useCreateExample = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: ExampleRequest) => examplesApi.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['examples'] });
      toast({
        title: '创建成功',
        description: '示例创建成功',
      });
    },
    onError: (error: any) => {
      toast({
        title: '创建失败',
        description: error.response?.data?.message || '创建示例时发生错误',
        variant: 'destructive',
      });
    },
  });
};

export const useUpdateExample = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: number; data: ExampleRequest }) => 
      examplesApi.update(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['examples'] });
      queryClient.invalidateQueries({ queryKey: ['example'] });
      toast({
        title: '更新成功',
        description: '示例更新成功',
      });
    },
    onError: (error: any) => {
      toast({
        title: '更新失败',
        description: error.response?.data?.message || '更新示例时发生错误',
        variant: 'destructive',
      });
    },
  });
};

export const useDeleteExample = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: number) => examplesApi.delete(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['examples'] });
      toast({
        title: '删除成功',
        description: '示例删除成功',
      });
    },
    onError: (error: any) => {
      toast({
        title: '删除失败',
        description: error.response?.data?.message || '删除示例时发生错误',
        variant: 'destructive',
      });
    },
  });
};
```

#### 3.2.4 创建 UI 组件

在 `frontend/src/components/example/` 目录创建组件：

```typescript
// frontend/src/components/example/example-list.tsx
import React from 'react';
import { useExamples, useDeleteExample } from '@/hooks/use-examples';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from '@/components/ui/alert-dialog';
import { Pencil, Trash2 } from 'lucide-react';
import type { Example } from '@/types/example';

interface ExampleListProps {
  onEdit: (example: Example) => void;
}

export const ExampleList: React.FC<ExampleListProps> = ({ onEdit }) => {
  const { data: examples, isLoading } = useExamples();
  const deleteExample = useDeleteExample();

  const handleDelete = (id: number) => {
    deleteExample.mutate(id);
  };

  if (isLoading) {
    return (
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {[...Array(6)].map((_, i) => (
          <Card key={i}>
            <CardHeader>
              <Skeleton className="h-4 w-[250px]" />
            </CardHeader>
            <CardContent>
              <Skeleton className="h-4 w-[200px]" />
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }

  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {examples?.map((example) => (
        <Card key={example.id}>
          <CardHeader>
            <CardTitle className="flex items-center justify-between">
              {example.name}
              <div className="flex gap-2">
                <Button
                  variant="outline"
                  size="icon"
                  onClick={() => onEdit(example)}
                >
                  <Pencil className="h-4 w-4" />
                </Button>
                <AlertDialog>
                  <AlertDialogTrigger asChild>
                    <Button variant="outline" size="icon">
                      <Trash2 className="h-4 w-4" />
                    </Button>
                  </AlertDialogTrigger>
                  <AlertDialogContent>
                    <AlertDialogHeader>
                      <AlertDialogTitle>确认删除</AlertDialogTitle>
                      <AlertDialogDescription>
                        确定要删除示例 "{example.name}" 吗？此操作不可撤销。
                      </AlertDialogDescription>
                    </AlertDialogHeader>
                    <AlertDialogFooter>
                      <AlertDialogCancel>取消</AlertDialogCancel>
                      <AlertDialogAction onClick={() => handleDelete(example.id)}>
                        删除
                      </AlertDialogAction>
                    </AlertDialogFooter>
                  </AlertDialogContent>
                </AlertDialog>
              </div>
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-sm text-muted-foreground">
              {example.description || '无描述'}
            </p>
          </CardContent>
        </Card>
      ))}
    </div>
  );
};
```

```typescript
// frontend/src/components/example/example-dialog.tsx
import React from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { useCreateExample, useUpdateExample } from '@/hooks/use-examples';
import type { Example } from '@/types/example';

const exampleSchema = z.object({
  name: z.string().min(1, '名称不能为空'),
  description: z.string().optional(),
});

type ExampleFormData = z.infer<typeof exampleSchema>;

interface ExampleDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  example?: Example;
}

export const ExampleDialog: React.FC<ExampleDialogProps> = ({ 
  open, 
  onOpenChange, 
  example 
}) => {
  const createExample = useCreateExample();
  const updateExample = useUpdateExample();
  
  const form = useForm<ExampleFormData>({
    resolver: zodResolver(exampleSchema),
    defaultValues: {
      name: example?.name || '',
      description: example?.description || '',
    },
  });

  React.useEffect(() => {
    if (example) {
      form.reset({
        name: example.name,
        description: example.description || '',
      });
    } else {
      form.reset({
        name: '',
        description: '',
      });
    }
  }, [example, form]);

  const onSubmit = (data: ExampleFormData) => {
    if (example) {
      updateExample.mutate(
        { id: example.id, data },
        {
          onSuccess: () => {
            onOpenChange(false);
            form.reset();
          },
        }
      );
    } else {
      createExample.mutate(data, {
        onSuccess: () => {
          onOpenChange(false);
          form.reset();
        },
      });
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>
            {example ? '编辑示例' : '创建示例'}
          </DialogTitle>
          <DialogDescription>
            {example ? '修改示例信息' : '填写示例信息来创建新的示例'}
          </DialogDescription>
        </DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>名称</FormLabel>
                  <FormControl>
                    <Input placeholder="输入示例名称" {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="description"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>描述</FormLabel>
                  <FormControl>
                    <Textarea
                      placeholder="输入示例描述"
                      className="resize-none"
                      {...field}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <DialogFooter>
              <Button 
                type="button" 
                variant="outline" 
                onClick={() => onOpenChange(false)}
              >
                取消
              </Button>
              <Button 
                type="submit" 
                disabled={createExample.isPending || updateExample.isPending}
              >
                {createExample.isPending || updateExample.isPending 
                  ? (example ? '更新中...' : '创建中...') 
                  : (example ? '更新' : '创建')
                }
              </Button>
            </DialogFooter>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
};
```

#### 3.2.5 创建页面组件

在 `frontend/src/pages/` 目录创建页面：

```typescript
// frontend/src/pages/examples.tsx
import React, { useState } from 'react';
import { PageHeader } from '@/components/ui/page-header';
import { Button } from '@/components/ui/button';
import { ExampleList } from '@/components/example/example-list';
import { ExampleDialog } from '@/components/example/example-dialog';
import { Plus } from 'lucide-react';
import type { Example } from '@/types/example';

export const ExamplesPage: React.FC = () => {
  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [selectedExample, setSelectedExample] = useState<Example | undefined>();

  const handleCreate = () => {
    setSelectedExample(undefined);
    setIsDialogOpen(true);
  };

  const handleEdit = (example: Example) => {
    setSelectedExample(example);
    setIsDialogOpen(true);
  };

  return (
    <div className="space-y-6">
      <PageHeader>
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold tracking-tight">示例管理</h1>
            <p className="text-muted-foreground">
              管理系统中的示例数据
            </p>
          </div>
          <Button onClick={handleCreate}>
            <Plus className="mr-2 h-4 w-4" />
            创建示例
          </Button>
        </div>
      </PageHeader>

      <ExampleList onEdit={handleEdit} />

      <ExampleDialog
        open={isDialogOpen}
        onOpenChange={setIsDialogOpen}
        example={selectedExample}
      />
    </div>
  );
};
```

#### 3.2.6 添加路由

在 `frontend/src/config/routes.ts` 中添加路由配置：

```typescript
// 在现有路由配置中添加
{
  path: '/examples',
  name: 'Examples',
  element: <ExamplesPage />,
  meta: {
    requiresAuth: true,
    title: '示例管理',
  },
}
```

在侧边栏中添加导航链接（`frontend/src/components/sidebar.tsx`）。

### 3.3 权限配置

为新功能添加 RBAC 权限：

1. **在数据库中添加权限策略** (通过管理界面或直接SQL)：

```sql
-- 为管理员添加所有权限
INSERT INTO casbin_rule (ptype, v0, v1, v2, v3) VALUES ('p', 'admin', '*', 'example', '*');

-- 为项目经理添加读写权限
INSERT INTO casbin_rule (ptype, v0, v1, v2, v3) VALUES ('p', 'pm', '*', 'example', 'read');
INSERT INTO casbin_rule (ptype, v0, v1, v2, v3) VALUES ('p', 'pm', '*', 'example', 'write');

-- 为普通用户添加只读权限
INSERT INTO casbin_rule (ptype, v0, v1, v2, v3) VALUES ('p', 'user', '*', 'example', 'read');
```

2. **在前端添加权限检查**：

```typescript
// frontend/src/components/example/example-list.tsx
import { usePermissions } from '@/hooks/use-permissions';

export const ExampleList: React.FC<ExampleListProps> = ({ onEdit }) => {
  const { hasPermission } = usePermissions();
  const canWrite = hasPermission('example', 'write');
  const canDelete = hasPermission('example', 'delete');

  // 在渲染中使用权限检查
  {canWrite && (
    <Button variant="outline" size="icon" onClick={() => onEdit(example)}>
      <Pencil className="h-4 w-4" />
    </Button>
  )}
  
  {canDelete && (
    <AlertDialog>
      {/* 删除按钮 */}
    </AlertDialog>
  )}
};
```

## 4. 测试与部署

### 4.1 测试命令

```bash
# 后端测试
go test ./...

# 前端测试
cd frontend
npm run lint
npm run build
```

### 4.2 代码检查

```bash
# 后端代码整理
go mod tidy

# 前端安全审计
cd frontend
npm audit
npm audit fix
```

### 4.3 文档更新

添加新 API 后更新 Swagger 文档：

```bash
swag init -g cmd/main.go -o docs
```

### 4.4 生产部署流程

1. **构建前端**
2. **构建后端**
3. **配置环境变量**
4. **运行数据库迁移**
5. **启动应用**

参考 CLAUDE.md 中的详细部署指南。

## 5. 常见问题

### 5.1 开发环境问题

- **端口冲突**: 确保端口 65080 和 5173 没有被占用
- **权限错误**: 检查 RBAC 配置和用户角色分配
- **数据库错误**: 删除 `data.db` 重新创建干净的数据库

### 5.2 生产部署问题

- **静态文件**: 确保前端先构建，后端会自动包含静态文件
- **数据库连接**: 检查环境变量配置
- **存储配置**: MinIO/S3 配置正确性

### 5.3 权限问题

- **403 错误**: 检查用户角色和 Casbin 策略
- **JWT 过期**: 检查 token 有效期配置
- **多租户**: 确保请求头包含正确的 `x-tenant-id`

如需更多帮助，请查阅项目的 `CLAUDE.md` 文件或 Swagger API 文档。