# 灵活的存储扩展,添加本地文件存储

## 背景

现阶段使用minio做为存储,当不具备minio运行条件和小型的使用场景下,需要添加本地文件存储(可选)

## 后端

- go-backend-clean-architecture
- [app.go](bootstrap/app.go) 初始化minio的配置
- [file_route.go](api/route/file_route.go) 定义了路由(目前未启用,仅通过UploadRelease发布上传了文件)
- [file_controller.go](api/controller/file_controller.go) 定义了文件上传的控制器(目前还没有使用它)
- [minio_file_repository.go](repository/minio_file_repository.go) 定义了 minio上传的实现
- [file_usecase.go](usecase/file_usecase.go) 定义了文件上传的用例
- [release_controller.go](api/controller/release_controller.go) UploadRelease 函数中发布版本,其中包含了发布信息和文件,需要用到文件存储
- [release.go](ent/schema/release.go) 定义了文件 path ,name,size,hash 
- [share.go](ent/schema/share.go) 在分享的时候,分享指向了release中的文件

## 前端

- [settings.tsx](frontend/src/pages/settings.tsx) 目前实现了minio的单一设置
- 通知设置是不必要的

## 任务目标
将系统的文件存储后端，从使用默认的MinIO对象存储切换到本地磁盘存储(默认)，支持通过配置切换两种模式。
### 修改应用初始化
- 在 bootstrap/app.go 中，根据 StorageType 初始化 FileStorage 字段：
- 如果为 "disk"，用新建的本地存储实现
- 如果为 "minio"，继续用现有 MinIO 实现

### 路由与控制器适配
- api/route/file_route.go、api/route/package_route.go 等路由参数，从 *minio.Client 改为通用 domain.FileRepository
- api/route/route.go 和 cmd/main.go 统一传递新的 FileStorage 实例

### 前端适配
修改 frontend/src/components/settings/storage-settings.tsx，支持选择存储类型，并根据类型动态显示参数输入项